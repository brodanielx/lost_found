{% extends 'contacts/base_bootstrap.html' %}

{% load staticfiles %}
{% load humanize %}

<script type="text/javascript">
{% block js %}

  let getContacts = (sortkey) => {
    let endpoint = `api/recently_added/${sortkey}/`
    $.ajax({
      method: 'GET',
      url: endpoint,
      success: (data) => {
        sortGrid(data);
      },
      error: (error_data) => {
        console.log('error: ', error_data);
      }
    })
  }

  getContacts('created_at')

  let gridHeaders = document.querySelectorAll('.grid-header')
  gridHeaders.forEach(header => {
    header.addEventListener('click', () => {
      getContacts(header.id)
    })
  })

  let sortGrid = (data) => {
    console.log('sortGrid: ', data);
  }

{% endblock %}
</script>


{% block body_block %}

  <div class="jumbotron jumbotron-fluid">
  <div class="container">
    <h1 class="display-4 jumbo-h1">Tampa Lost Founds</h1>
    <div class="row">
      <div class="col-sm-4">
        <p class="lead">Total Lost Founds Added: {{ total_contacts }}</p>
      </div>
      <div class="col-sm-4">
        <p class="lead">Lost Founds in Tampa: {{ black_population|intcomma }}</p>
      </div>
      <div class="col-sm-4">
        <p class="lead">Percent in Database: {{ percent_lf_added }} %</p>
      </div>
    </div>
  </div>
</div>


<div class="container">
  <h4 class="lead">Recently Added by {{ user.first_name }} {{ user.last_name }}</h4>
  <table class="table table-hover">
  <thead>
    <tr>
      <th>#</th>
      <th class="grid-header" id="gender">
        Gender
      </th>
      <th class="grid-header" id="full_name">
        Name
      </th>
      <th class="grid-header" id="phone_number_formated">
        Phone #
      </th>
      <th class="grid-header" id="email">
        Email
      </th>
      <th class="grid-header" id="created_at">
        Date Added
      </th>
      <th>Edit</th>
    </tr>
  </thead>
  <tbody>
    {% for c in recently_added %}
      <tr>
        <th scope="row">{{ c.pk }}</th>
        <td>{{ c.gender }}</td>
        <td>
          <a href="{% url 'contacts:show_contact' c.pk %}">{{ c.full_name }}</a>
        </td>
        <td>{{ c.phone_number_formated }}</td>
        <td>{{ c.email }}</td>
        <td>{{ c.created_at|date:"n/j/y" }}</td>
        <td>
          <a class=""
            href="{% url 'contacts:edit_contact' c.pk %}">
            <i class="fa fa-pencil-square-o fa-lg" aria-hidden="true"></i>
          </a>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
</div>

{% endblock %}
